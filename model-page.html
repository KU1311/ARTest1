<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Model Viewer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
        }
        #canvas {
            width: 80%;
            height: 100vh;
            display: block;
        }
        #controls {
            width: 20%;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
        }
        h2 {
            margin: 0;
            font-size: 24px;
        }
        label {
            display: block;
            margin: 5px 0;
        }
    </style>
</head>
<body>

<div id="canvas"></div>
<div id="controls">
    <h2>3D模型</h2>
    <label for="modelSelect">請選擇模型:</label>
    <select id="modelSelect">
        <option value="newRoad" selected>擴闊行人路, 不另設設施</option>
        <option value="parking" selected>泊車位和花槽</option>
        <option value="parking with tree" selected>泊車位, 花槽, 樹</option>
        <option value="seatings" selected>座椅和花槽</option>
        <option value="seatings with tree" selected>座椅, 花槽, 樹</option>
        <option value="trees" selected>樹</option>
        <option value="trees with bushes" selected>花槽和樹</option>
    </select>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r128/examples/js/loaders/OBJLoader.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r128/examples/js/loaders/MTLLoader.js"></script>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r128/examples/js/controls/OrbitControls.js"></script>
<script>
    // Initialize your scene, camera, and renderer here
    scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas').appendChild(renderer.domElement);

        // Set the background color (light blue for sky, gray for ground)
        const skyColor = new THREE.Color(0x87CEEB); // Light blue
        const groundColor = new THREE.Color(0xA9A9A9); // Gray
        
        // Create a gradient effect
        const gradientTexture = createGradientTexture(skyColor, groundColor);
        scene.background = gradientTexture;
        
        // Function to create a gradient texture
        function createGradientTexture(skyColor, groundColor) {
            const size = 512; // Texture size
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            
            const context = canvas.getContext('2d');
            
            // Create gradient
            const gradient = context.createLinearGradient(0, 0, 0, size);
            gradient.addColorStop(0, skyColor.getStyle()); // Sky color
            gradient.addColorStop(1, groundColor.getStyle()); // Ground color
        
            context.fillStyle = gradient;
            context.fillRect(0, 0, size, size);
            
            // Create texture from canvas
            const texture = new THREE.Texture(canvas);
            texture.needsUpdate = true; // Update texture
            return texture;
        }
        
        // Set camera position
        camera.position.set(-5, 5, -10);
        //camera.rotation.y = Math.PI; 

         // Make the camera look at the origin
        camera.lookAt(-100, -50, -50);
    
    // Global variable to store loaded models
    let models = {};
    
    // Function to load models
    function loadModel(mtlPath, objPath, modelName, addToScene) {
        const mtlLoader = new THREE.MTLLoader();
        const objLoader = new THREE.OBJLoader();
    
        mtlLoader.load(mtlPath, (materials) => {
            materials.preload(); // Preload materials
    
            objLoader.setMaterials(materials);
            objLoader.load(objPath, (object) => {
                // Traverse through all children of the loaded object
                object.traverse((child) => {
                    if (child.isMesh) {
                        // Adjust material properties to make it matte
                        if (child.material) {
                            if (Array.isArray(child.material)) {
                                child.material.forEach((material) => {
                                    if (material.isMeshStandardMaterial) {
                                        material.roughness = 1;
                                        material.metalness = 0;
                                    } else if (material.isMeshPhongMaterial) {
                                        material.shininess = 0;
                                    }
                                });
                            } else {
                                if (child.material.isMeshStandardMaterial) {
                                    child.material.roughness = 1;
                                    child.material.metalness = 0;
                                } else if (child.material.isMeshPhongMaterial) {
                                    child.material.shininess = 0;
                                }
                            }
                        }
                        child.castShadow = true; 
                        child.receiveShadow = true; 
                    }
                });
    
                // Store the model in the global models object
                models[modelName] = object;
                if (addToScene) {
                    scene.add(object);
                }
            });
        });
    }
    
    // Function to remove all loaded models from the scene
    function removeAllModels() {
        for (let modelName in models) {
            if (models[modelName]) {
                scene.remove(models[modelName]);
            }
        }
    }
    
    // Function to load the initial basic model
    function loadInitialModel() {
        loadModel('models/base.mtl', 'models/base.obj', 'baseModel', true);
        loadModel('models/cars.mtl', 'models/cars.obj', 'carsModel', true);
    }
    
    // Load the initial basic model
    loadInitialModel();
    
    // Event listener for the dropdown selection
    const modelSelect = document.getElementById('modelSelect');
    modelSelect.addEventListener('change', (event) => {
        const selectedModel = event.target.value;
    
        // Remove all previously loaded additional models
        removeAllModels();
    
        // Load the selected model
        switch (selectedModel) {
            case 'newRoad':
                loadModel('models/newRoad.mtl', 'models/newRoad.obj', 'newRoadModel', true);
                break;
            case 'parking':
                loadModel('models/newRoad.mtl', 'models/newRoad.obj', 'newRoadModel', true);
                loadModel('models/parking.mtl', 'models/parking.obj', 'parkingModel', true);
                loadModel('models/seats2.mtl', 'models/seats2.obj', 'seatsModel2', true);
                break;
             case 'parking with tree':
                loadModel('models/newRoad.mtl', 'models/newRoad.obj', 'newRoadModel', true);
                loadModel('models/parking.mtl', 'models/parking.obj', 'parkingModel', true);
                loadModel('models/seats2.mtl', 'models/seats2.obj', 'seatsModel2', true);
                loadModel('models/trees.mtl', 'models/trees.obj', 'treesModel', true);
                break;
            case 'seatings':
                loadModel('models/newRoad.mtl', 'models/newRoad.obj', 'newRoadModel', true);
                loadModel('models/seatings.mtl', 'models/seatings.obj', 'seatingsModel', true);
                loadModel('models/bushes.mtl', 'models/bushes.obj', 'bushesModel', true);
                break;
            case 'seatings with tree':
                loadModel('models/newRoad.mtl', 'models/newRoad.obj', 'newRoadModel', true);
                loadModel('models/seatings.mtl', 'models/seatings.obj', 'seatingsModel', true);
                loadModel('models/bushes.mtl', 'models/bushes.obj', 'bushesModel', true);
                loadModel('models/trees.mtl', 'models/trees.obj', 'treesModel', true);
                break;
            case 'trees':
                loadModel('models/newRoad.mtl', 'models/newRoad.obj', 'newRoadModel', true);
                loadModel('models/trees.mtl', 'models/trees.obj', 'treesModel', true);
                break;
            case 'trees with bushes':
                loadModel('models/newRoad.mtl', 'models/newRoad.obj', 'newRoadModel', true);
                loadModel('models/trees.mtl', 'models/trees.obj', 'treesModel', true);
                loadModel('models/bushes.mtl', 'models/bushes.obj', 'bushesModel', true);
                break;
            default:
                console.log("Model not found");
        }
    });
    
    // Render loop
    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
    
    // Start the animation loop
    animate();

    init();
</script>

</body>
</html>
