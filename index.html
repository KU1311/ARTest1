<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthy Walking Trail Experience Day</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            background-color: #f7f7f7;
        }
        .hidden {
            display: none;
        }
        .container {
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #cameraView {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/three.js/three.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/THREEx/threex-artoolkit.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/r128/examples/js/loaders/OBJLoader.js"></script>
</head>
<body>

<div id="welcome" class="container">
    <h1>Healthy Walking Trail Experience Day</h1>
    <p>Explore our future pedestrian path and share your ideas!</p>
    <button onclick="showLocationPrompt()">Get Started</button>
</div>

<div id="locationPrompt" class="container hidden">
    <p>To create a personalized experience, please allow access to your location.</p>
    <button onclick="requestLocation()">Allow</button>
    <button onclick="denyLocation()">Deny</button>
</div>

<div id="arExperience" class="container hidden">
    <h2>AR Visualization</h2>
    <p>Point your camera at the road to see the transformation!</p>
    <button onclick="enterARMode()">Enter AR Mode</button>
    <div id="cameraView"></div>
</div>

<div id="interactiveElements" class="container hidden">
    <h2>Interactive Elements</h2>
    <button onclick="addElement('bench')">Add Bench</button>
    <button onclick="addElement('tree')">Add Tree</button>
    <button onclick="removeElement()">Remove Last Element</button>
    <button onclick="submitIdeas()">Submit Your Ideas</button>
</div>

<div id="feedbackForm" class="container hidden">
    <h2>Feedback Submission</h2>
    <input type="text" class="input-field" placeholder="Your Name (optional)">
    <input type="email" class="input-field" placeholder="Your Email (optional)">
    <textarea class="input-field" placeholder="What features would you like to see?"></textarea>
    <button onclick="submitFeedback()">Submit</button>
</div>

<div id="thankYou" class="container hidden">
    <h2>Thank You!</h2>
    <p>Your ideas will help shape our community.</p>
    <button onclick="goHome()">Return to Home</button>
</div>

<script>
    let scene, camera, renderer, arToolkitSource, arToolkitContext;
    let markerRoot1;
    let addedElements = [];

    function showLocationPrompt() {
        document.getElementById('welcome').classList.add('hidden');
        document.getElementById('locationPrompt').classList.remove('hidden');
    }

    function requestLocation() {
        document.getElementById('locationPrompt').classList.add('hidden');
        document.getElementById('arExperience').classList.remove('hidden');
    }

    function denyLocation() {
        alert("Location access denied. Limited functionality.");
        document.getElementById('locationPrompt').classList.add('hidden');
        document.getElementById('arExperience').classList.remove('hidden');
    }

    function enterARMode() {
        initialize();
        document.getElementById('interactiveElements').classList.remove('hidden');
    }

    function initialize() {
        scene = new THREE.Scene();
        let ambientLight = new THREE.AmbientLight(0xcccccc, 1.0);
        scene.add(ambientLight);
        camera = new THREE.Camera();
        scene.add(camera);
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setClearColor(new THREE.Color('lightgrey'), 0);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('cameraView').appendChild(renderer.domElement);

        // Setup arToolkitSource
        arToolkitSource = new THREEx.ArToolkitSource({ sourceType: 'webcam' });

        function onResize() {
            arToolkitSource.onResize();
            arToolkitSource.copySizeTo(renderer.domElement);
            if (arToolkitContext.arController !== null) {
                arToolkitSource.copySizeTo(arToolkitContext.arController.canvas);
            }
        }

        arToolkitSource.init(() => { onResize(); });

        // Handle resize event
        window.addEventListener('resize', () => {
            onResize();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Setup arToolkitContext
        arToolkitContext = new THREEx.ArToolkitContext({
            cameraParametersUrl: 'data/camera_para.dat',
            detectionMode: 'mono'
        });

        arToolkitContext.init(() => {
            camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
        });

        // Setup markerRoots
        markerRoot1 = new THREE.Group();
        scene.add(markerRoot1);
        let markerControls1 = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
            type: 'pattern', patternUrl: "data/hiro.patt",
        });

        // Load the base model
        loadModel('site.obj', markerRoot1);
    }

    function loadModel(url, parent) {
        const loader = new THREE.OBJLoader();
        loader.load(url, (object) => {
            parent.add(object);
            // If the model has materials, they can be applied here
            object.traverse((child) => {
                if (child.isMesh) {
                    child.material = new THREE.MeshNormalMaterial(); // Replace with actual material
                }
            });
        }, undefined, (error) => {
            console.error('An error happened while loading the model:', error);
        });
    }

    function addElement(type) {
        let modelUrl = '';
        if (type === 'bench') {
            modelUrl = 'bench.obj';
        } else if (type === 'tree') {
            modelUrl = 'tree.obj';
        }

        if (modelUrl) {
            loadModel(modelUrl, markerRoot1);
            addedElements.push(type); // Keep track of added elements
        }
    }

    function removeElement() {
        if (addedElements.length > 0) {
            // Logic to remove the last added element
            addedElements.pop();
            alert("Last element removed! (Requires AR integration for actual removal)");
        } else {
            alert("No elements to remove.");
        }
    }

    function submitIdeas() {
        document.getElementById('interactiveElements').classList.add('hidden');
        document.getElementById('feedbackForm').classList.remove('hidden');
    }

    function submitFeedback() {
        alert("Thank you for your feedback!");
        document.getElementById('feedbackForm').classList.add('hidden');
        document.getElementById('thankYou').classList.remove('hidden');
    }

    function goHome() {
        document.getElementById('thankYou').classList.add('hidden');
        document.getElementById('welcome').classList.remove('hidden');
    }

    function animate() {
        requestAnimationFrame(animate);
        if (arToolkitSource.ready) {
            arToolkitContext.update(arToolkitSource.domElement);
            renderer.render(scene, camera);
        }
    }

    animate(); // Start the animation loop

</script>

</body>
</html>
